{% extends "base.html" %}
{% load i18n thumbnail staticfiles embed_video_tags pifti %}
{% block page_class %}Home{% endblock %}
{% load cache %}

{% block content %}
<h1>i'm from the internet.</h1>
  {% if pagination_list %}
  <div id="posts">
    {% for post in pagination_list %}
    <div class="post" id="{{ post.id }}">
      <div class="post_content clearfix">
        <div class="image">
          {% if post.image %}
            <a target="_blank" href="{{ post.image.url }}"><img src="{{ post.image.avatar.url }}" /></a>
            {% cache 86400 post_imagetype post.id %}
            {% if post.image|isanimated %}
            <div class="imagetype">
                <span>{% imagetype post.image %}</span>
            </div>
            {% endif %}
            {% endcache %}
          {% endif %}
        </div>
        <div class="bump">
          <div class="title">
            <div class="post_number inline">#{{ post.id }}</div>
            <div class="post_title inline">{{ post.title }}</div>
            <div class="post_information inline">by {{ post.user.username }} on {{ post.created }}</div>
          </div>
          <div class="text">
            <div>{{ post.body|linebreaksbr|urlize|emojize }}</div>
            {% if post.media and post.media != "" %}
            {% cache 604800 post_media post.id %}
              {% video post.media 'tiny' is_secure="{{ request.is_secure }}" as v %}
                <div class="media_embed" data-embed="{{ v.backend }}" data-id="{{ v.code }}" style="height: {{ v.height }}px;">
                  <div class="media_cover" style="background-image: url({{ v.thumbnail }})">
                    <div class="media_meta">
                      <div class="play_button {{ v.backend }}"></div>
                      <span class="media_author">{{ v.username }}</span><br/>
                      <span class="media_title">{{ v.title }}</span>
                    </div>
                  </div>
                </div>
              {% endvideo %}
            {% endcache %}
            {% endif %}
          </div>
        </div>
        <div class="actions">
          <ul>
            <li><a href="{% url 'imageboard:add_comment' post.id %}"><img title="Comment" src="{% static 'comment_alt2_fill.svg' %}" /></a></li>
            {% if user.is_superuser or user == post.user %}
            <li><a href="{% url 'imageboard:edit_post' post.id %}"><img title="Edit" src="{% static 'wrench.svg' %}" /></a></li>
            <li><a href="{% url 'imageboard:delete_post' post.id %}"><img title="Delete" src="{% static 'x_alt.svg' %}" /></a></li>
            {% endif %}
          </ul>
        </div>
      </div>
      <div class="comments">
        {% for comment in post.comment_set.all reversed %}
        {% if forloop.counter|add:user.userprofile.comment_filter <= post.comment_set.all|length %}
            {% if forloop.first %}
                <div class="comments-hidden">
            {% endif %}
        {% endif %}
        <div class="comment clearfix">
          <div class="image">
            {% if comment.image %}
              <a target="_blank" href="{{ comment.image.url }}"><img src="{{ comment.image.avatar.url }}" /></a>
              {% cache 86400 comment_imagetype comment.id %}
              {% if comment.image|isanimated %}
              <div class="imagetype">
                  <span>{% imagetype comment.image %}</span>
              </div>
              {% endif %}
              {% endcache %}
            {% endif %}
          </div>
          <div class="bump">
            <div class="title">
              <div class="comment_information inline">{{ comment.user.username }} on {{ comment.created }}</div>
            </div>
            <div class="text">
              <div>{{ comment.body|linebreaksbr|urlize|emojize }}</div>
              {% if comment.media and comment.media != "" %}
              {% cache 604800 comment_media comment.id %}
                {% video comment.media 'tiny' is_secure="{{ request.is_secure }}" as v %}
                  <div class="media_embed" data-embed="{{ v.backend }}" data-id="{{ v.code }}" style="height: {{ v.height }}px;">
                    <div class="media_cover" style="background-image: url({{ v.thumbnail }})">
                      <div class="media_meta">
                        <div class="play_button {{ v.backend }}"></div>
                        <span class="media_author">{{ v.username }}</span><br/>
                        <span class="media_title">{{ v.title }}</span>
                      </div>
                    </div>
                  </div>
                {% endvideo %}
              {% endcache %}
              {% endif %}
            </div>
          </div>
          <div class="actions">
              <ul>
                {% if forloop.last and forloop.counter > 1 %}
                <li><a href="{% url 'imageboard:add_comment' post.id %}"><img title="Comment" src="{% static 'comment_alt2_fill.svg' %}" /></a></li>
                {% endif %}
                {% if user.is_superuser or user == comment.user %}
                <li><a href="{% url 'imageboard:edit_comment' post.id comment.id %}"><img title="Edit" src="{% static 'wrench.svg' %}" /></a></li>
                <li><a href="{% url 'imageboard:delete_comment' post.id comment.id %}"><img title="Delete" src="{% static 'x_alt.svg' %}" /></a></li>
                {% endif %}
              </ul>
            </div>
        </div>
        {% if forloop.counter|add:user.userprofile.comment_filter == post.comment_set.all|length %}
          </div>
          <div class="comments-expand">Show Hidden Comments</div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endfor %}
  </div>
  <a class="mobile-top" href="#top">Back to Top</a>
  {% else %}
  <p>No posts are available.</p>
  {% endif %}
{% endblock %}